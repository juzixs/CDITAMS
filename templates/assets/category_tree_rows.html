{% load asset_tags %}
{% get_category_children root as children %}
<tr class="parent-row child-of-{% if root.parent %}{{ root.parent.id }}{% else %}0{% endif %}" data-level="{{ root.level }}" data-id="{{ root.id }}">
<td>
{% if children %}
<span class="tree-toggle expanded" data-id="{{ root.id }}"><i class="fas fa-minus-square"></i></span>
{% else %}
<span style="display:inline-block;width:20px;"></span>
{% endif %}
</td>
<td style="padding-left: {% if root.level == 1 %}12{% else %}{{ root.level | add:1 }}0{% endif %}px;">
{% if root.level == 1 %}<i class="fas fa-folder text-warning me-1"></i>
{% elif root.level == 2 %}<i class="fas fa-folder-open text-primary me-1"></i>
{% elif root.level == 3 %}<i class="fas fa-folder-tree text-info me-1"></i>
{% else %}<i class="fas fa-file-alt text-success me-1"></i>{% endif %}
<strong>{{ root.name }}</strong>
</td>
<td><code>{{ root.code|default:'-' }}</code></td>
<td><span class="badge bg-{% if root.level == 1 %}warning text-dark{% elif root.level == 2 %}primary{% elif root.level == 3 %}info{% else %}success{% endif %} level-badge">{{ root.level }}级</span></td>
<td>{{ root.parent.name|default:'-' }}</td>
<td>{{ root.sort }}</td>
<td>
<a href="{% url 'category_edit' root.id %}" class="btn btn-sm btn-outline-secondary"><i class="fas fa-edit"></i></a>
{% if not root.children.exists and not root.devices.exists %}
<a href="{% url 'category_delete' root.id %}" class="btn btn-sm btn-outline-danger" onclick="return confirm('确定删除该分类？')"><i class="fas fa-trash"></i></a>
{% else %}
<button type="button" class="btn btn-sm btn-outline-secondary" disabled title="该分类下有子分类或设备"><i class="fas fa-trash"></i></button>
{% endif %}
</td>
</tr>
{% if children %}
{% for child in children %}
{% include 'assets/category_tree_rows.html' with root=child %}
{% endfor %}
{% endif %}
